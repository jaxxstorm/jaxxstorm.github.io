<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Introducing Graphping | lbr.</title>

<meta name="description" content="Engineering, DevOps & Cloud Computing
">
<meta name="keywords" content="software, golang">
<link rel="canonical" href="/blog/2017/01/25/introducing-graphping.html">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-34865189-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-34865189-1');
</script>


<!--Feature assets-->
<!--Bootstrap JS-->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

<!--Font Awesome-->
<link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>

<!--Highlight.js-->
<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.3.2/build/styles/default.min.css">
<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.3.2/build/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<!--Main assets-->
<link rel="icon" type="image/jpeg" href="/favicon.png"/>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link rel="stylesheet" href="/assets/css/main.css">
</head>
<body>
<div class="wrapper">
<header class="header">
<div class="navigation">

<a href="/" class="logo">lbr.</a>

<ul class="menu">
<li class="menu__entry"><a href="/">about</a></li>
<li class="menu__entry"><a href="/projects">projects</a></li>
<li class="menu__entry"><a href="/blog">blog</a></li>
</ul>
</div>
<ul class="social-links">

<a href="mailto:/contact@leebriggs.co.uk" class="social-links__entry" target="_blank">
<i class="fas fa-envelope-square"></i>
</a>


<a href="https://github.com//jaxxstorm" class="social-links__entry" target="_blank">
<i class="fab fa-github"></i>
</a>


<a href="https://linkedin.com/in//briggsl" class="social-links__entry" target="_blank">
<i class="fab fa-linkedin-in"></i>
</a>

</ul>
</header>

<br>
<br>
<h1 class="post-title">
    <div class="post-title__text">Introducing Graphping</div>
</h1>
<p class="post-title__subtitle">Published Jan 25, 2017  by <a href="https://leebriggs.co.uk/">Lee Briggs<a><br />


    <span class="badge badge-info">#software</span>

    <span class="badge badge-info">#golang</span>

<hr>
<br>
<p>One of the first tools I came across when I started out in the IT industry was <a href="http://oss.oetiker.ch/smokeping/">SmokePing</a>. It’s been around for years and solves the important job of graphing latency between two points in a reasonable way. As a company grows and scales out into multiple datacenters, latency can affect the operation of software, so having it graphed makes a lot of sense.</p>

<p>I was surprised that there hasn’t been any alternative to SmokePing developed in the years since it was conceived. This is probably a testament to how well it works, but in my case, I already had a kick-ass graphite installation (with <a href="http://grafana.org/">Grafana</a> frontend, obviously) and I wanted to get my latency metrics in there, rather than having to support RRD tool and install a perl app.</p>

<p>So, I set about reinventing the wheel. Something on my radar was to get my head around <a href="https://golang.org/">Go</a> and this seemed perfect for the task because:</p>

<ul>
  <li>It’s fast</li>
  <li>You can build binaries with it super easily</li>
  <li>It has concurrency built in</li>
</ul>

<p>The last point was a big consideration, because pinging lots of endpoints consistently like SmokePing would be much easier if it’s trivial to launch concurrent operations. Go’s <a href="https://tour.golang.org/concurrency/1">goroutines</a> make this very easy.</p>

<h2 id="graphping-is-born">Graphping is Born</h2>

<p>So, with all this in mind, a colleague and I wrote Graphping. You can see the source code <a href="https://github.com/jaxxstorm/graphping">here</a>.</p>

<p>In order to run it, you need to specify a config file, and an address for a <a href="https://github.com/etsy/statsd">statsd server</a>. Making use of statsd means you can write metrics to any of the available statsd <a href="https://github.com/etsy/statsd/blob/master/docs/backend.md">backends</a> which allows you to use your existing monitoring infrastructure.</p>

<p>The config file makes use of <a href="https://github.com/hashicorp/hcl">HCL</a> which means you can either write a human readable config file, or use a machine generated JSON config file. An example config file looks like this:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">interval <span class="o">=</span> 10 <span class="c"># A global interval. Can be overwritten per target group</span>
prefix <span class="o">=</span> <span class="s2">"graphping"</span> <span class="c"># A global prefix for statsd metrics</span>


<span class="c"># Declare a target group with a name</span>
target_group <span class="s2">"search_engines"</span> <span class="o">{</span>
  <span class="c"># a custom ping interval for this group</span>
  interval <span class="o">=</span> 2
  <span class="c"># A prefix for the statsd metric for this group</span>
  prefix <span class="o">=</span> <span class="s2">"search"</span>
  <span class="c"># A name for the target. This becomes the statsd metric</span>
  target <span class="s2">"google"</span> <span class="o">{</span>
    address <span class="o">=</span> <span class="s2">"www.google.co.uk"</span>
  <span class="o">}</span>
  target <span class="s2">"bing"</span> <span class="o">{</span>
    address <span class="o">=</span> <span class="s2">"www.bing.com"</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c"># You can specify multiple target groups</span>
target_group <span class="s2">"news_sites"</span> <span class="o">{</span>
  prefix <span class="o">=</span> <span class="s2">"uk"</span>
  target <span class="s2">"bbc"</span> <span class="o">{</span>
    address <span class="o">=</span> <span class="s2">"www.bbc.co.uk"</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>This all comes together to allow you to create graphs very similar to SmokePing. Here’s an example:</p>

<p><img src="http://i.imgur.com/1766B2Z.png" alt="" /></p>

<p>This is only my second project in Go, so there might be some issues or bugs and the code quality might not be fantastic. Hopefully as time goes on, further improvements will come.</p>


<br>

<div id="disqus_thread"></div>
<script>


var disqus_config = function () {
this.page.url = 'http://localhost:4000/assets/style.css';
this.page.identifier = '/blog/2017/01/25/introducing-graphping.html'; 
};

(function() {
var d = document, s = d.createElement('script');
s.src = 'https://.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            

<br>
<div class="about">
<div class="about__devider">*****</div>
<div class="about__text">
<br>
&#169 2021, Lee Briggs | <a href="https://github.com/ritijjain/pudhina-fresh">Pudhina Fresh</a> theme for Jekyll.
</div>
</div>

</div>
</body>
</html>